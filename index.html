<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Ç–æ—á–µ–∫</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .video-section {
            flex: 1;
            min-width: 300px;
        }
        
        .points-section {
            flex: 1;
            min-width: 300px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            margin-bottom: 20px;
        }
        
        #video {
            width: 100%;
            max-width: 640px;
            height: 480px;
            border-radius: 10px;
            background: #000;
            transform: scaleX(-1);
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            max-width: 640px;
            height: 480px;
            pointer-events: none;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: #4CAF50;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        #stopButton {
            background: #f44336;
        }
        
        #stopButton:hover {
            background: #da190b;
        }
        
        .info-panel {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        #info {
            font-size: 16px;
            line-height: 1.5;
            color: #333;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .loading { background: #fff3cd; color: #856404; }
        .success { background: #d1edff; color: #004085; }
        .error { background: #f8d7da; color: #721c24; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ç–æ—á–µ–∫ */
        .points-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .points-table th,
        .points-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .points-table th {
            background: #e9ecef;
            font-weight: bold;
        }
        
        .points-table tr:hover {
            background: #f1f3f4;
        }
        
        .point-visual {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            border: 2px solid #fff;
        }
        
        .point-visible { background: #28a745; }
        .point-hidden { background: #dc3545; }
        
        .confidence-bar {
            width: 100px;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            display: inline-block;
            margin-left: 10px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545, #ffc107, #28a745);
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .points-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .summary-item {
            text-align: center;
            flex: 1;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 12px;
            color: #666;
        }
        
        .visible-point { color: #28a745; }
        .hidden-point { color: #dc3545; }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .video-section, .points-section {
                min-width: 100%;
            }
            
            #video, #canvas {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üï∫ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Ç–æ—á–µ–∫</h1>
        
        <div class="main-content">
            <div class="video-section">
                <div class="video-container">
                    <video id="video" autoplay playsinline></video>
                    <canvas id="canvas"></canvas>
                </div>
                
                <div class="controls">
                    <button id="startButton">üé• –í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
                    <button id="stopButton" disabled>‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    <button id="screenshotButton" disabled>üì∏ –°–Ω–∏–º–æ–∫</button>
                </div>
                
                <div id="status" class="status loading">
                    ‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏...
                </div>
                
                <div class="info-panel">
                    <div id="info">
                        –ù–∞–∂–º–∏—Ç–µ "–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
                    </div>
                </div>
            </div>
            
            <div class="points-section">
                <h3>üìä –î–µ—Ç–µ–∫—Ü–∏—è —Ç–æ—á–µ–∫ —Ç–µ–ª–∞</h3>
                
                <div class="points-summary">
                    <div class="summary-item">
                        <div class="summary-value visible-point" id="visibleCount">0</div>
                        <div class="summary-label">–í–∏–¥–∏–º—ã—Ö —Ç–æ—á–µ–∫</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value hidden-point" id="hiddenCount">17</div>
                        <div class="summary-label">–°–∫—Ä—ã—Ç—ã—Ö —Ç–æ—á–µ–∫</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="totalCount">17</div>
                        <div class="summary-label">–í—Å–µ–≥–æ —Ç–æ—á–µ–∫</div>
                    </div>
                </div>
                
                <table class="points-table">
                    <thead>
                        <tr>
                            <th>–¢–æ—á–∫–∞</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</th>
                        </tr>
                    </thead>
                    <tbody id="pointsTable">
                        <!-- –¢–æ—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
    
    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const screenshotButton = document.getElementById('screenshotButton');
        const status = document.getElementById('status');
        const info = document.getElementById('info');
        const pointsTable = document.getElementById('pointsTable');
        const visibleCount = document.getElementById('visibleCount');
        const hiddenCount = document.getElementById('hiddenCount');
        const totalCount = document.getElementById('totalCount');
        
        let detector;
        let isDetecting = false;
        let animationId;

        // –ù–∞–∑–≤–∞–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫ —Ç–µ–ª–∞
        const BODY_POINTS = [
            "–ù–æ—Å", "–õ–µ–≤–æ–µ –≥–ª–∞–∑–æ", "–ü—Ä–∞–≤–æ–µ –≥–ª–∞–∑–æ", "–õ–µ–≤–æ–µ —É—Ö–æ", "–ü—Ä–∞–≤–æ–µ —É—Ö–æ",
            "–õ–µ–≤–æ–µ –ø–ª–µ—á–æ", "–ü—Ä–∞–≤–æ–µ –ø–ª–µ—á–æ", "–õ–µ–≤—ã–π –ª–æ–∫–æ—Ç—å", "–ü—Ä–∞–≤—ã–π –ª–æ–∫–æ—Ç—å",
            "–õ–µ–≤–æ–µ –∑–∞–ø—è—Å—Ç—å–µ", "–ü—Ä–∞–≤–æ–µ –∑–∞–ø—è—Å—Ç—å–µ", "–õ–µ–≤–æ–µ –±–µ–¥—Ä–æ", "–ü—Ä–∞–≤–æ–µ –±–µ–¥—Ä–æ",
            "–õ–µ–≤–æ–µ –∫–æ–ª–µ–Ω–æ", "–ü—Ä–∞–≤–æ–µ –∫–æ–ª–µ–Ω–æ", "–õ–µ–≤–∞—è –ª–æ–¥—ã–∂–∫–∞", "–ü—Ä–∞–≤–∞—è –ª–æ–¥—ã–∂–∫–∞"
        ];

        // –¶–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–µ–π —Ç–µ–ª–∞
        const POINT_COLORS = {
            head: '#FF6B6B',      // –ö—Ä–∞—Å–Ω—ã–π - –≥–æ–ª–æ–≤–∞
            arms: '#4ECDC4',      // –ë–∏—Ä—é–∑–æ–≤—ã–π - —Ä—É–∫–∏
            torso: '#45B7D1',     // –°–∏–Ω–∏–π - —Ç–æ—Ä—Å
            legs: '#96CEB4'       // –ó–µ–ª–µ–Ω—ã–π - –Ω–æ–≥–∏
        };

        // –ì—Ä—É–ø–ø—ã —Ç–æ—á–µ–∫ –ø–æ —á–∞—Å—Ç—è–º —Ç–µ–ª–∞
        const POINT_GROUPS = {
            head: [0, 1, 2, 3, 4],           // –ì–æ–ª–æ–≤–∞
            arms: [5, 6, 7, 8, 9, 10],       // –†—É–∫–∏
            torso: [5, 6, 11, 12],           // –¢–æ—Ä—Å
            legs: [11, 12, 13, 14, 15, 16]   // –ù–æ–≥–∏
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message, type = 'loading') {
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ –ø–æ–∑
        async function initPoseDetector() {
            try {
                updateStatus('üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ TensorFlow.js...');
                await tf.ready();
                
                updateStatus('üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–æ–∑...');
                const model = poseDetection.SupportedModels.MoveNet;
                detector = await poseDetection.createDetector(model, {
                    modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING,
                });
                
                updateStatus('‚úÖ –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', 'success');
                startButton.disabled = false;
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É —Ç–æ—á–µ–∫
                initializePointsTable();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                updateStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏: ' + error.message, 'error');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã —Ç–æ—á–µ–∫
        function initializePointsTable() {
            pointsTable.innerHTML = '';
            
            BODY_POINTS.forEach((pointName, index) => {
                const row = document.createElement('tr');
                const group = getPointGroup(index);
                const color = POINT_COLORS[group];
                
                row.innerHTML = `
                    <td>
                        <span class="point-visual point-hidden" style="border-color: ${color}"></span>
                        ${index}
                    </td>
                    <td>${pointName}</td>
                    <td>
                        <span class="status-text" style="color: #dc3545">‚ùå –°–∫—Ä—ã—Ç–∞</span>
                    </td>
                    <td>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: 0%"></div>
                        </div>
                        <span class="confidence-text">0%</span>
                    </td>
                `;
                
                pointsTable.appendChild(row);
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã —Ç–æ—á–∫–∏
        function getPointGroup(index) {
            if (POINT_GROUPS.head.includes(index)) return 'head';
            if (POINT_GROUPS.arms.includes(index)) return 'arms';
            if (POINT_GROUPS.torso.includes(index)) return 'torso';
            if (POINT_GROUPS.legs.includes(index)) return 'legs';
            return 'head';
        }

        // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã
        async function setupCamera() {
            try {
                updateStatus('üì∑ –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...');
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user' 
                    } 
                });
                
                video.srcObject = stream;
                
                return new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play();
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        resolve(video);
                    };
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã:', error);
                updateStatus('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ', 'error');
                throw error;
            }
        }

        // –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
        function calculateDistance(point1, point2) {
            const dx = point1.x - point2.x;
            const dy = point1.y - point2.y;
            return Math.sqrt(dx * dx + dy * dy) * 100;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–∫–µ–ª–µ—Ç–∞ —Å —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
        function drawSkeleton(keypoints) {
            // –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ —Å —Ü–≤–µ—Ç–∞–º–∏ –ø–æ –≥—Ä—É–ø–ø–∞–º
            const connections = [
                // –ì–æ–ª–æ–≤–∞
                { points: [0, 1], color: POINT_COLORS.head },
                { points: [0, 2], color: POINT_COLORS.head },
                { points: [1, 3], color: POINT_COLORS.head },
                { points: [2, 4], color: POINT_COLORS.head },
                
                // –†—É–∫–∏
                { points: [5, 7], color: POINT_COLORS.arms },
                { points: [7, 9], color: POINT_COLORS.arms },
                { points: [6, 8], color: POINT_COLORS.arms },
                { points: [8, 10], color: POINT_COLORS.arms },
                
                // –¢–æ—Ä—Å
                { points: [5, 6], color: POINT_COLORS.torso },
                { points: [5, 11], color: POINT_COLORS.torso },
                { points: [6, 12], color: POINT_COLORS.torso },
                { points: [11, 12], color: POINT_COLORS.torso },
                
                // –ù–æ–≥–∏
                { points: [11, 13], color: POINT_COLORS.legs },
                { points: [13, 15], color: POINT_COLORS.legs },
                { points: [12, 14], color: POINT_COLORS.legs },
                { points: [14, 16], color: POINT_COLORS.legs }
            ];

            // –†–∏—Å—É–µ–º –ª–∏–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
            connections.forEach(connection => {
                const [i, j] = connection.points;
                const kp1 = keypoints[i];
                const kp2 = keypoints[j];
                
                if (kp1.score > 0.3 && kp2.score > 0.3) {
                    ctx.strokeStyle = connection.color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(kp1.x * canvas.width, kp1.y * canvas.height);
                    ctx.lineTo(kp2.x * canvas.width, kp2.y * canvas.height);
                    ctx.stroke();
                }
            });

            // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ —Å —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
            keypoints.forEach((keypoint, index) => {
                if (keypoint.score > 0.1) { // –ë–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    const x = keypoint.x * canvas.width;
                    const y = keypoint.y * canvas.height;
                    const group = getPointGroup(index);
                    const color = POINT_COLORS[group];
                    
                    // –í–Ω–µ—à–Ω–∏–π –∫—Ä—É–≥
                    ctx.beginPath();
                    ctx.arc(x, y, 8, 0, 2 * Math.PI);
                    ctx.fillStyle = color;
                    ctx.fill();
                    
                    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—Ä—É–≥ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å)
                    const confidence = Math.min(keypoint.score * 100, 100);
                    const innerRadius = 4 * (confidence / 100);
                    
                    ctx.beginPath();
                    ctx.arc(x, y, innerRadius, 0, 2 * Math.PI);
                    ctx.fillStyle = confidence > 50 ? '#FFFFFF' : '#FFEB3B';
                    ctx.fill();
                    
                    // –ù–æ–º–µ—Ä —Ç–æ—á–∫–∏
                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = '10px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(index.toString(), x, y);
                }
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
        function drawDistances(keypoints) {
            ctx.strokeStyle = '#FF00FF';
            ctx.lineWidth = 2;
            ctx.font = '12px Arial';
            ctx.fillStyle = '#333333';

            const distances = [
                { points: [5, 6], label: '–ü–ª–µ—á–∏' },
                { points: [9, 10], label: '–ö–∏—Å—Ç–∏' },
                { points: [11, 12], label: '–ë–µ–¥—Ä–∞' },
                { points: [5, 11], label: '–õ–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞' },
                { points: [6, 12], label: '–ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞' }
            ];

            distances.forEach(({ points: [i, j], label }) => {
                const kp1 = keypoints[i];
                const kp2 = keypoints[j];
                
                if (kp1 && kp2 && kp1.score > 0.3 && kp2.score > 0.3) {
                    const x1 = kp1.x * canvas.width;
                    const y1 = kp1.y * canvas.height;
                    const x2 = kp2.x * canvas.width;
                    const y2 = kp2.y * canvas.height;
                    
                    // –ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    // –ü–æ–¥–ø–∏—Å—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
                    const midX = (x1 + x2) / 2;
                    const midY = (y1 + y2) / 2;
                    const distance = calculateDistance(kp1, kp2).toFixed(1);
                    
                    // –§–æ–Ω –¥–ª—è —Ç–µ–∫—Å—Ç–∞
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.fillRect(midX - 25, midY - 15, 50, 20);
                    
                    ctx.fillStyle = '#333';
                    ctx.fillText(`${distance}`, midX, midY);
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–æ—á–µ–∫
        function updatePointsTable(keypoints) {
            let visiblePoints = 0;
            
            keypoints.forEach((keypoint, index) => {
                const row = pointsTable.rows[index];
                if (!row) return;
                
                const confidence = Math.round(keypoint.score * 100);
                const isVisible = confidence >= 30;
                const group = getPointGroup(index);
                const color = POINT_COLORS[group];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                const pointVisual = row.querySelector('.point-visual');
                pointVisual.className = `point-visual ${isVisible ? 'point-visible' : 'point-hidden'}`;
                pointVisual.style.borderColor = color;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                const statusText = row.querySelector('.status-text');
                statusText.textContent = isVisible ? '‚úÖ –í–∏–¥–∏–º–∞' : '‚ùå –°–∫—Ä—ã—Ç–∞';
                statusText.style.color = isVisible ? '#28a745' : '#dc3545';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
                const confidenceFill = row.querySelector('.confidence-fill');
                const confidenceText = row.querySelector('.confidence-text');
                confidenceFill.style.width = `${confidence}%`;
                confidenceText.textContent = `${confidence}%`;
                
                if (isVisible) visiblePoints++;
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
            visibleCount.textContent = visiblePoints;
            hiddenCount.textContent = BODY_POINTS.length - visiblePoints;
            totalCount.textContent = BODY_POINTS.length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Å—á–µ—Ç—á–∏–∫–æ–≤
            visibleCount.className = `summary-value ${visiblePoints > 0 ? 'visible-point' : ''}`;
            hiddenCount.className = `summary-value ${visiblePoints < BODY_POINTS.length ? 'hidden-point' : ''}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateInfo(keypoints) {
            const visiblePoints = keypoints.filter(kp => kp.score >= 0.3).length;
            const totalPoints = BODY_POINTS.length;
            const coverage = Math.round((visiblePoints / totalPoints) * 100);
            
            let infoText = `üï∫ –¢–µ–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ!\n\n`;
            infoText += `üìä –ü–æ–∫—Ä—ã—Ç–∏–µ: ${coverage}% (${visiblePoints}/${totalPoints} —Ç–æ—á–µ–∫)\n\n`;
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ç–æ—á–∫–∏ –ø–æ –≤–∏–¥–∏–º–æ—Å—Ç–∏
            const groups = {
                '–ì–æ–ª–æ–≤–∞': keypoints.slice(0, 5).filter(kp => kp.score >= 0.3).length,
                '–†—É–∫–∏': keypoints.slice(5, 11).filter(kp => kp.score >= 0.3).length,
                '–¢–æ—Ä—Å': [5,6,11,12].map(i => keypoints[i]).filter(kp => kp.score >= 0.3).length,
                '–ù–æ–≥–∏': keypoints.slice(11).filter(kp => kp.score >= 0.3).length
            };
            
            Object.entries(groups).forEach(([group, count]) => {
                const total = group === '–ì–æ–ª–æ–≤–∞' ? 5 : group === '–†—É–∫–∏' ? 6 : group === '–¢–æ—Ä—Å' ? 4 : 6;
                const percent = Math.round((count / total) * 100);
                infoText += `${group}: ${count}/${total} (${percent}%)\n`;
            });
            
            info.textContent = infoText;
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
        async function detectPose() {
            if (!isDetecting) return;
            
            try {
                // –û—á–∏—â–∞–µ–º canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // –†–∞—Å–ø–æ–∑–Ω–∞–µ–º –ø–æ–∑—É
                const poses = await detector.estimatePoses(video);
                
                if (poses.length > 0) {
                    const pose = poses[0];
                    const keypoints = pose.keypoints;
                    
                    // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–∫–µ–ª–µ—Ç –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
                    drawSkeleton(keypoints);
                    drawDistances(keypoints);
                    updatePointsTable(keypoints);
                    updateInfo(keypoints);
                    
                    updateStatus(`‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è: ${keypoints.filter(kp => kp.score >= 0.3).length}/17 —Ç–æ—á–µ–∫`, 'success');
                } else {
                    updatePointsTable(Array(17).fill().map(() => ({ score: 0 })));
                    info.textContent = '‚ùå –¢–µ–ª–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ. –í—Å—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–µ–¥ –∫–∞–º–µ—Ä–æ–π.';
                    updateStatus('üîç –ü–æ–∏—Å–∫ —Ç–µ–ª–∞...', 'loading');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:', error);
                updateStatus('‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è', 'error');
            }
            
            // –°–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä
            animationId = requestAnimationFrame(detectPose);
        }

        // –°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞
        function takeScreenshot() {
            const link = document.createElement('a');
            link.download = `body-tracking-${new Date().getTime()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        startButton.addEventListener('click', async () => {
            try {
                startButton.disabled = true;
                await setupCamera();
                
                stopButton.disabled = false;
                screenshotButton.disabled = false;
                isDetecting = true;
                
                updateStatus('üéØ –ù–∞—á–∞–ª–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è...', 'success');
                detectPose();
                
            } catch (error) {
                startButton.disabled = false;
            }
        });

        stopButton.addEventListener('click', () => {
            isDetecting = false;
            cancelAnimationFrame(animationId);
            
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            startButton.disabled = false;
            stopButton.disabled = true;
            screenshotButton.disabled = true;
            
            info.textContent = '–ö–∞–º–µ—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É" –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è.';
            updateStatus('‚èπÔ∏è –ö–∞–º–µ—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', 'loading');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Ç–æ—á–µ–∫
            initializePointsTable();
        });

        screenshotButton.addEventListener('click', takeScreenshot);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', initPoseDetector);
    </script>
</body>
</html>